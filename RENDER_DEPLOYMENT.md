# üöÄ Deploy IM Services to Render

Complete guide to deploy your IM Services website (frontend + backend) on Render.

## üìã Prerequisites

Before deployment, ensure you have:
- [ ] GitHub account with your code pushed
- [ ] MongoDB Atlas account with cluster created (free tier available)
- [ ] Gmail account with App Password configured
- [ ] Render account (sign up at https://render.com - free)

---

## üóÑÔ∏è Step 1: Setup MongoDB Atlas (Database)

### 1.1 Create MongoDB Atlas Cluster

1. Go to https://www.mongodb.com/cloud/atlas
2. Sign up or log in
3. Click **"Build a Database"**
4. Select **FREE** (M0 Sandbox tier)
5. Choose **Cloud Provider & Region** (select closest to Singapore/Asia for best performance)
6. Name your cluster: `imservices-cluster`
7. Click **"Create"**

### 1.2 Create Database User

1. In sidebar, go to **"Database Access"**
2. Click **"Add New Database User"**
3. Choose **"Password"** authentication
4. Username: `imservices`
5. Click **"Autogenerate Secure Password"** (save this password!)
6. Database User Privileges: **"Read and write to any database"**
7. Click **"Add User"**

### 1.3 Configure Network Access

1. In sidebar, go to **"Network Access"**
2. Click **"Add IP Address"**
3. Click **"Allow Access from Anywhere"** (0.0.0.0/0)
4. Click **"Confirm"**

> ‚ö†Ô∏è **Security Note**: For production, you can add Render's specific IP ranges later.

### 1.4 Get Connection String

1. Go back to **"Database"** in sidebar
2. Click **"Connect"** on your cluster
3. Select **"Connect your application"**
4. Copy the connection string, it looks like:
   ```
   mongodb+srv://imservices:<password>@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority
   ```
5. Replace `<password>` with your actual database password
6. Add database name before the `?`:
   ```
   mongodb+srv://imservices:YOUR_PASSWORD@cluster0.xxxxx.mongodb.net/imservices?retryWrites=true&w=majority
   ```

---

## üìß Step 2: Setup Gmail App Password

### 2.1 Enable 2-Factor Authentication

1. Go to https://myaccount.google.com/security
2. Enable **2-Step Verification** if not already enabled

### 2.2 Create App Password

1. Go to https://myaccount.google.com/apppasswords
2. Select app: **"Mail"**
3. Select device: **"Other (Custom name)"**
4. Name it: **"IM Services Render"**
5. Click **"Generate"**
6. Copy the 16-character password (format: `xxxx xxxx xxxx xxxx`)

> ‚ö†Ô∏è **Save this**: You won't be able to see it again!

---

## üîß Step 3: Deploy to Render

### Option A: Deploy via render.yaml (Recommended)

#### 3.1 Prepare Your Repository

1. Make sure all changes are committed and pushed to GitHub:
   ```bash
   git add .
   git commit -m "Add Render deployment configuration"
   git push origin main
   ```

2. Ensure `render.yaml` exists in your repository root (it should already be there)

#### 3.2 Deploy on Render Dashboard

1. Go to https://dashboard.render.com
2. Sign up or log in (use GitHub for easier integration)
3. Click **"New +"** ‚Üí **"Blueprint"**
4. Connect your GitHub repository:
   - If first time: Click **"Connect GitHub"** and authorize Render
   - Select your `IM_SERVICES` repository
5. Give your Blueprint a name: **"IM Services"**
6. Click **"Apply"**

#### 3.3 Configure Environment Variables

Render will automatically create two services from the `render.yaml`:
- `im-services-backend` (Web Service)
- `im-services-frontend` (Static Site)

**For Backend Service**, add these environment variables:

1. Go to **`im-services-backend`** service
2. Click **"Environment"** tab
3. Add the following variables:

| Key | Value |
|-----|-------|
| `MONGODB_URI` | Your MongoDB Atlas connection string from Step 1.4 |
| `EMAIL_USER` | Your Gmail address (e.g., `imservices4444@gmail.com`) |
| `EMAIL_PASS` | Your Gmail App Password from Step 2.2 (remove spaces) |
| `EMAIL_FROM` | Your Gmail address |
| `ADMIN_EMAIL` | Your Gmail address |
| `JWT_SECRET` | Auto-generated by Render |
| `NODE_ENV` | `production` (already set) |
| `PORT` | `5000` (already set) |

4. Click **"Save Changes"**

**For Frontend Service**:
- The `VITE_API_URL` will be automatically set to your backend URL
- No additional configuration needed!

#### 3.4 Deploy

1. Services will automatically start building
2. Wait 5-10 minutes for both services to deploy
3. Once complete, both will show **"Live"** status

---

### Option B: Manual Deployment (Alternative)

If you prefer to deploy services individually:

#### Backend Deployment

1. Go to https://dashboard.render.com
2. Click **"New +"** ‚Üí **"Web Service"**
3. Connect your GitHub repository
4. Configure:
   - **Name**: `im-services-backend`
   - **Region**: Singapore (or closest to you)
   - **Branch**: `main`
   - **Root Directory**: `backend`
   - **Runtime**: Node
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Plan**: Free
5. Click **"Advanced"** and add environment variables (same as Step 3.3)
6. Click **"Create Web Service"**

#### Frontend Deployment

1. Click **"New +"** ‚Üí **"Static Site"**
2. Connect your GitHub repository
3. Configure:
   - **Name**: `im-services-frontend`
   - **Region**: Singapore
   - **Branch**: `main`
   - **Root Directory**: `frontend`
   - **Build Command**: `npm install && npm run build`
   - **Publish Directory**: `dist`
   - **Plan**: Free
4. Add environment variable:
   - **Key**: `VITE_API_URL`
   - **Value**: Your backend URL (e.g., `https://im-services-backend.onrender.com`)
5. Click **"Create Static Site"**

---

## ‚úÖ Step 4: Verify Deployment

### 4.1 Check Backend Health

1. Go to your backend URL: `https://im-services-backend.onrender.com/api/health`
2. You should see:
   ```json
   {
     "status": "OK",
     "message": "IM Services API is running"
   }
   ```

### 4.2 Check Frontend

1. Visit your frontend URL: `https://im-services-frontend.onrender.com`
2. The website should load correctly

### 4.3 Test Functionality

- [ ] Homepage loads
- [ ] Navigate to Services page
- [ ] Sign up for a new account
- [ ] Log in
- [ ] Submit a booking (if logged in)
- [ ] Submit contact form
- [ ] Verify you receive emails
- [ ] Check admin dashboard (if you have admin account)

---

## üåê Step 5: Custom Domain (Optional)

### 5.1 Add Domain to Frontend

1. Go to your `im-services-frontend` service
2. Click **"Settings"** tab
3. Under **"Custom Domain"**, click **"Add Custom Domain"**
4. Enter your domain: `www.yourdomain.com`
5. Follow DNS configuration instructions

### 5.2 Update Backend CORS

If using custom domain, update `backend/server.js` CORS configuration:

```javascript
app.use(cors({
  origin: ['https://www.yourdomain.com', 'https://yourdomain.com'],
  credentials: true
}));
```

Commit and push changes - Render will auto-redeploy.

---

## üîÑ Auto-Deploy Setup

Render automatically redeploys when you push to GitHub:

1. Make changes locally
2. Commit and push:
   ```bash
   git add .
   git commit -m "Your update message"
   git push origin main
   ```
3. Render will automatically detect changes and redeploy
4. Check **"Events"** tab to monitor deployment

---

## üìä Monitoring Your Application

### Backend Logs

1. Go to **`im-services-backend`** service
2. Click **"Logs"** tab
3. Monitor real-time logs for errors or issues

### Frontend Logs

1. Go to **`im-services-frontend`** service
2. Click **"Logs"** tab
3. View build and deployment logs

### Database Monitoring

1. Go to MongoDB Atlas dashboard
2. Click **"Metrics"** to see:
   - Connections
   - Operations
   - Storage usage

---

## ‚ö†Ô∏è Important Notes

### Free Tier Limitations

- **Backend (Web Service)**:
  - Spins down after 15 minutes of inactivity
  - First request after spin-down takes ~30-60 seconds
  - 750 hours/month of runtime

- **Frontend (Static Site)**:
  - 100GB bandwidth/month
  - Always online (no spin-down)

- **MongoDB Atlas Free Tier**:
  - 512MB storage
  - Shared resources
  - No backups

### Keep Backend Awake (Optional)

To prevent backend from spinning down:

1. Use a service like UptimeRobot (https://uptimerobot.com)
2. Add your backend health check URL: `https://im-services-backend.onrender.com/api/health`
3. Set ping interval to 5 minutes
4. Free plan allows 50 monitors

---

## üêõ Troubleshooting

### Backend won't start

**Check:**
- All environment variables are set correctly
- MongoDB connection string is valid
- Gmail App Password is correct (no spaces)
- View logs for specific error messages

### Frontend shows API errors

**Check:**
- `VITE_API_URL` environment variable is set correctly
- Backend service is running and healthy
- Check browser console for CORS errors

### Emails not sending

**Check:**
- Gmail App Password is correct
- 2-Factor Authentication is enabled on Gmail
- Check backend logs for email errors
- Verify EmailJS configuration (if used)

### Database connection errors

**Check:**
- MongoDB Atlas cluster is running
- Network access allows connections from anywhere (0.0.0.0/0)
- Database user credentials are correct
- Connection string format is correct

### Slow first request

**This is normal** for free tier - backend spins down after inactivity.
- First request takes 30-60 seconds (cold start)
- Subsequent requests are fast
- Consider using UptimeRobot to keep it awake

---

## üìû Support

For deployment issues:
- Render Docs: https://render.com/docs
- MongoDB Atlas Docs: https://docs.atlas.mongodb.com
- Email: imservices4444@gmail.com

---

## üéâ Congratulations!

Your IM Services website is now live on Render!

**Your URLs:**
- Frontend: `https://im-services-frontend.onrender.com`
- Backend: `https://im-services-backend.onrender.com`
- Health Check: `https://im-services-backend.onrender.com/api/health`

Share your website with clients and start receiving service requests! üöÄ
